(up) [[Northeastern Cluster]]

###Setting public access to HaaS node
Two ways; manually or through HaaS via setting public network through HaaS master

###Logging into the Haas Master

Before you start, make sure ssh-agent is running and your key is added.  [Instructions here](#sshagent).

Make sure your public key is on the HaaS master.  To have it added, send a request to moc-ops-team-list@bu.edu.

In a terminal type

    ssh -A -D <PORT#> <USERNAME>@129.10.5.48

Where `<PORT#>` is any outgoing port on your machine that is not in use.

#####Accessing the OBMs

Change your proxy settings to use a SOCKS proxy with the port number you used above.  More instructions for this are available [here](https://github.com/CCI-MOC/moc-public/wiki/Access-the-OpenStack-dashboard).

Now, you should be able to reach the OBM in your browser at `http://10.99.1.x`, where x is 101,102,...,148 for servers 1 through 48.

#####Accessing Foreman

The Foreman VM is at [http://10.13.37.1].  Request an admin password from moc-ops-team-list@bu.edu

Go to Hosts-> All Hosts and then click on host that you want to use.  Its IP address `10.13.37.x` will be shown.  Note that 'x' generally will not match the number in the name of the node.

### Logging in to the nat-public gateway

The Gateway/DNS/DHCP server for the `nat-public` network in HaaS is a
headnode called `nat-pub-gateway`, owned by the project `haas-admins`.
Regular use does not require logging in to this machine.

The machine can be reached from the HaaS master via the IP address
`192.168.122.80`. Only Jay, Laura, and the three engineers have access
to this (the users are configured via the manifests in the
`puppet-internal` repository). These same users also have sudo access,
though at present only `isd` has a password set. Talk to him if you need
a password so you can sudo.

###Using the server at 10.13.37.x

Log in to the HaaS Master with your public key to the HaaS Master, and from there to the Foreman VM.

    ravisantosh@ravisantosh-Inspiron-5521:~$ ssh -A ravig@129.10.3.48
    Last login: Sat Jul 25 19:25:54 2015 from syrah.ccs.neu.edu
    [ravig@haas-master ~]$ ssh -A root@192.168.122.162
    Last login: Sat Jul 25 19:30:05 2015 from 192.168.122.1
    [root@foreman ~]#

Then log in to your node:

    [root@foreman ~]# ssh -A root@10.13.37.23
    The authenticity of host '10.13.37.23 (10.13.37.23)' can't be established.
    ECDSA key fingerprint is 05:d4:c8:32:b0:05:a5:0a:2b:61:06:2c:da:3a:6d:5a.
    Are you sure you want to continue connecting (yes/no)? yes
    Warning: Permanently added '10.13.37.23' (ECDSA) to the list of known hosts.
    root@10.13.37.23's password:
    Last login: Fri Jul 10 13:40:13 2015 from compute-35.moc.ne.edu
    [root@compute-43 ~]#

So, you are now logged into the box. Next, bring down network manager using following command:

    [root@compute-43 ~]# systemctl stop NetworkManager


*Note: Before following these steps to put your node on the public network, please review the steps at [[Security Best Practices]].*

Create configuration file for your network interface at `/etc/sysconfig/network-scripts/ifcfg-enp130s0f0.125`:

    TYPE=Ethernet
    BOOTPROTO=static
    DEVICE=enp130s0f0.125
    NAME=enp130s0f0.125
    ONBOOT=yes
    IPADDR=129.10.3.x
    NETMASK=255.255.255.128
    GATEWAY=129.10.3.1
    DNS1=8.8.8.8
    VLAN=yes

Then type:

    [root@compute-43 ~]# ifup ifcfg-enp130s0f0.125

This will bring up the public interface which makes this node accessible from outside world.

###Subscribe to the RHEL Portal

For installing RPMs we need to subscribe this node to RHEL portal.

    [root@compute-43 ~]# subscription-manager register(This needs RHEL account)
    [root@compute-43 ~]# subscription-manager attach --auto

###<a name="sshagent"></a>Setting up ssh agent

To checking whether an agent is running already:

    $ ps -aux | grep ssh-agent

To start the agent, from the command line type `ssh-agent`

The output will look something like this:

    SSH_AUTH_SOCK=/tmp/ssh-N2O3IxWPoczq/agent.4328; export SSH_AUTH_SOCK;
    SSH_AGENT_PID=4329; export SSH_AGENT_PID;
    echo Agent pid 4329;

You should export these values by copy/pasting into the shell.  (Use the values generated by your own ssh-agent, not the ones from this page.)

Then execute the following ssh-add command, which adds your key:

    ravisantosh@ravisantosh-Inspiron-5521:~$ ssh-add
    Enter passphrase for /home/ravisantosh/.ssh/id_rsa

To check whether the key is added:

    $ ssh-add -l

